/*! SDV.js (Spatial Data Visualization) version 0.1.0-dev.
    A JS library for spatial data analysis and visualization on interactive web maps.
    Builded 2015-06-11.
 */
!function(window,document,undefined){"use strict";var SDV={version:"0.1.0",name:"SDV.js"};SDV.defineSdv=function(){var a=window.SDV;SDV.noConflict=function(){return window.SDV=a,this},window.SDV=SDV},window!==undefined&&SDV.defineSdv(),SDV.Util={},SDV.Util.Validation={validateOption:function(a,b){var c={isValid:!0,isDefined:"undefined"!=typeof b,message:""},d=a.optionFullName||a.optionName;if("undefined"==typeof a)return c;if(!c.isDefined)return a.isRequired&&(c.isValid=!1,c.message=SDV.Localization.getResource("missingRequiredParameterError")(d)),c;if(SDV.Util.Array.isArray(a.allowedTypes)){for(var e=!0,f="",g=function(a,b){if(!SDV.Util.Array.isArray(a))return!1;for(var c=0,d=a.length;d>c;c++)if(!b(a[c]))return!1;return!0},h={String:SDV.Util.String.isString,Number:SDV.Util.Number.isNumber,Integer:SDV.Util.Number.isInteger,Boolean:SDV.Util.Boolean.isBoolean,Function:SDV.Util.Function.isFunction,Array:SDV.Util.Array.isArray,Object:SDV.Util.Object.isObject,Null:function(a){return SDV.Util.Object.isObject(a,!0)},StringArray:function(a){return g(a,SDV.Util.String.isString)},NumberArray:function(a){return g(a,SDV.Util.Number.isNumber)},IntegerArray:function(a){return g(a,SDV.Util.Number.isInteger)},BooleanArray:function(a){return g(a,SDV.Util.Boolean.isBoolean)},FunctionArray:function(a){return g(a,SDV.Util.Function.isFunction)},ObjectArray:function(a){return g(a,SDV.Util.Object.isObject)},ObjectOrNullArray:function(a){return g(a,function(a){return SDV.Util.Object.isObject(a,!0)})}},i=0,j=a.allowedTypes.length;j>i;i++){var k=a.allowedTypes[i];if(h.hasOwnProperty(k)){if(h[k](b)){e=!0,f="";break}e=!1,f=SDV.Localization.getResource("wrongParameterTypeError")({parameterName:d,actualValue:b,expectedType:a.allowedTypes})}else e=!1,f=SDV.Localization.getResource("wrongParameterValueError")({parameterName:"validationOptions.allowedTypes["+i+"]",actualValue:k,allowedValues:SDV.Util.Object.getPropertiesNames(h)})}if(!e)return c.isValid=!1,c.message=f,c}var l=!0,m="";if(SDV.Util.Number.isNumber(b)){if("undefined"!=typeof a.minValue&&(l=a.minValueEqualityAllowed?b>=a.minValue:b>a.minValue,!l))return m=SDV.Localization.getResource("wrongParameterValueError")({parameterName:d,actualValue:b,allowedValues:(a.minValueEqualityAllowed?">= ":"> ")+a.minValue}),c.isValid=!1,c.message=m,c;if("undefined"!=typeof a.maxValue&&(l=a.maxValueEqualityAllowed?b<=a.maxValue:b<a.maxValue,!l))return m=SDV.Localization.getResource("wrongParameterValueError")({parameterName:d,actualValue:b,allowedValues:(a.maxValueEqualityAllowed?"<= ":"< ")+a.maxValue}),c.isValid=!1,c.message=m,c}if(SDV.Util.Array.isArray(a.allowedValues)){var n=a.allowedValues.length;if(l=n>0&&SDV.Util.Array.contains(a.allowedValues,b)||0==n,!l)return m=SDV.Localization.getResource("wrongParameterValueError")({parameterName:d,actualValue:b,allowedValues:a.allowedValues}),c.isValid=!1,c.message=m,c}if(SDV.Util.Function.isFunction(a.postValidationMethod)){var o=a.postValidationMethod(a.postValidationMethodOptions);SDV.Util.Object.isObject(o)&&(c.isValid=o.isValid===!0,c.message=o.message||"")}return c},validateOptions:function(a,b,c){var d={isValid:!0,message:""};if("undefined"==typeof a)return d;if(b=b||{},!SDV.Util.Object.isObject(b))return d.isValid=!1,d.message=SDV.Localization.getResource("wrongParameterTypeError")({parameterName:"options",actualValue:b,expectedType:"[object Object]"}),d;for(var e="undefined"!=typeof c,f=0,g=a.length;g>f;f++){var h=a[f],i=SDV.Util.Validation.validateOption(h,b[h.optionName]);if(e&&(h.replaceWithDefaultIfInvalid&&!i.isValid||h.replaceWithDefaultIfUndefined&&!i.isDefined)){var j=SDV.Util.Validation.validateOption(h,c[h.optionName]);j.isValid?(b[h.optionName]=c[h.optionName],i.isValid=!0,i.isDefined="undefined"!=typeof b[h.optionName]):d=j}if(!i.isValid)return d.isValid=!1,d.message=i.message,d}return d}},SDV.Util.Boolean={isBoolean:function(a){return"[object Boolean]"===Object.prototype.toString.call(a)}},SDV.Util.String={isString:function(a){return"[object String]"===Object.prototype.toString.call(a)},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},insert:function(a,b,c,d){var e=SDV.Util.String.isString(a)?a.length:0,f=SDV.Util.Validation.validateOptions([{optionName:"strDist",isRequired:!0,allowedTypes:["String"]},{optionName:"strSrc",isRequired:!0,allowedTypes:["String"]},{optionName:"start",isRequired:!0,allowedTypes:["Integer"],minValue:0,minValueEqualityAllowed:!0,maxValue:e,maxValueEqualityAllowed:!0},{optionName:"end",isRequired:!1,allowedTypes:["Integer"],minValue:c,minValueEqualityAllowed:!0,maxValue:e,maxValueEqualityAllowed:!0}],{strDist:a,strSrc:b,start:c,end:d});if(!f.isValid)throw new Error(f.message);var g=c===e,h="undefined"==typeof d;return g?a+b:a.substr(0,c)+b+(h?a.substr(c):e>=d+1?a.substr(d+1):"")},getWords:function(a){return SDV.Util.String.trim(a).split(/\s+/)},transliterateCyrillicToLatin:function(a){var b={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"y","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"ts","ч":"ch","ш":"sh","щ":"shch","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya"};return a.replace(/[\s\S]/g,function(a){var c,d;return c=d=a.toLowerCase(),b.hasOwnProperty(d)&&(c=b[d],a===a.toUpperCase()&&(c=c.charAt(0).toUpperCase()+c.substr(1))),c})}},SDV.Util.Number={isNumber:function(a){return"[object Number]"===Object.prototype.toString.call(a)},isInteger:window.Number.isInteger||function(a){return SDV.Util.Number.isNumber(a)&&isFinite(a)&&Math.floor(a)===a},isEven:function(a){return SDV.Util.Number.isNumber(a)&&a%2==0},isOdd:function(a){return SDV.Util.Number.isNumber(a)&&Math.abs(a)%2==1}},SDV.Util.Array={isArray:window.Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},indexOf:function(a,b,c){if(!SDV.Util.Array.isArray(a))throw new TypeError(SDV.Localization.getResource("wrongParameterTypeError",{parameterName:"array",actualValue:a,expectedType:"[object Array]"}));if(window.Array.prototype.indexOf)return a.indexOf(b,c);var d,e=Object(a),f=e.length>>>0;if(0===f)return-1;var g=+c||0;if(Math.abs(g)===1/0&&(g=0),g>=f)return-1;for(d=Math.max(g>=0?g:f-Math.abs(g),0);f>d;){if(d in e&&e[d]===b)return d;d++}return-1},contains:function(a,b){return SDV.Util.Array.indexOf(a,b)>-1},each:function(a,b){var c=SDV.Util.Validation.validateOptions([{optionName:"array",isRequired:!0,allowedTypes:["Array"]},{optionName:"callback",isRequired:!0,allowedTypes:["Function"]}],{array:a,callback:b});if(!c.isValid)throw new Error(c.message);for(var d=0,e=a.length;e>d;d++){var f=b(a[d],d,a)===!1;if(f)break}}},SDV.Util.Function={isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)},bind:function(a,b){var c=Array.prototype.slice;if(a.bind)return a.bind.apply(a,c.call(arguments,1));var d=c.call(arguments,2);return function(){return a.apply(b,d.length?d.concat(c.call(arguments)):arguments)}}},SDV.Util.Object={isObject:function(a,b){var c=Object.prototype.toString.call(a),d="[object Object]"===c;return!d&&b&&(d=null===a),d},create:Object.create||function(){var a=function(){},b=function(b){if("object"!=typeof b)throw new TypeError(SDV.Localization.getResource("wrongParameterTypeError")({parameterName:"prototype",actualValue:b,expectedType:"[object Object]"}));a.prototype=b;var c=new a;return a.prototype=null,c};return b}(),extend:function(a,b,c){if(SDV.Util.Object.isObject(a)&&SDV.Util.Object.isObject(b))for(var d in b){var e=a[d],f=b[d];c===!0&&SDV.Util.Object.isObject(e)&&SDV.Util.Object.isObject(f)?SDV.Util.Object.extend(e,f,c):a[d]=f}return a},getPropertiesNames:function(a,b){var c=[];if(SDV.Util.Object.isObject(a))for(var d in a)(b||!b&&a.hasOwnProperty(d))&&c.push(d);return c},getPropertyValue:function(a){a=a||{};var b=a.srcObject,c=a.propertyName;if("undefined"!=typeof b&&null!==b&&SDV.Util.String.isString(c))for(var d=c.split("."),e=d.length,f=e;f>=0;f--){var g=d.slice(0,f).join("."),h=b[g];if("undefined"!=typeof h){if(e>f){var i=d.slice(f,e).join(".");return SDV.Util.Object.getPropertyValue({srcObject:h,propertyName:i})}return h}}}},function(a){SDV.Util.Object.uniqueId=function(b,c){if(SDV.Util.String.isString(c)&&""!==SDV.Util.String.trim(c)||(c="uniqueId"),"undefined"==typeof b&&null===b)return null;if(!SDV.Util.Number.isNumber(b[c]))try{b[c]=++a}catch(d){return a--,null}return b[c]}}(0),SDV.Util.Json={parse:window.JSON?window.JSON.parse:function(jsonString){return eval("("+jsonString+")")},stringify:window.JSON?window.JSON.stringify:function(){var a=window.Object.prototype.toString,b=SDV.Util.Array.isArray,c={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},d=function(a){return c[a]||"\\u"+(a.charCodeAt(0)+65536).toString(16).substr(1)},e=/[\\"\u0000-\u001F\u2028\u2029]/g;return function f(c){if(null==c)return"null";if("number"==typeof c)return window.isFinite(c)?c.toString():"null";if("boolean"==typeof c)return c.toString();if("object"==typeof c){if("function"==typeof c.toJSON)return f(c.toJSON());if(b(c)){for(var g="[",h=0;h<c.length;h++)g+=(h?", ":"")+f(c[h]);return g+"]"}if("[object Object]"===a.call(c)){var i=[];for(var j in c)c.hasOwnProperty(j)&&i.push(f(j)+": "+f(c[j]));return"{"+i.join(", ")+"}"}}return'"'+c.toString().replace(e,d)+'"'}}(),getFromFile:function(a){return SDV.Util.Ajax.makeRequest({url:a.filePath,method:"GET",async:a.async,timeout:a.timeout,responseContentType:"json",onSuccess:a.onSuccess,onError:a.onError})}},SDV.Util.Xml={isXml:function(a){var b=Object.prototype.toString.call(a);return"[object XMLDocument]"===b||"[object Document]"===b&&SDV.Util.String.isString(a.xmlVersion)||"[object Object]"===b&&window.ActiveXObject&&SDV.Util.String.isString(a.xml)&&"undefined"!=typeof a.getElementsByTagName},parse:function(a){var b,c;try{window.DOMParser?(c=new window.DOMParser,b=c.parseFromString(a,"text/xml")):window.ActiveXObject&&(b=new window.ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a))}catch(d){b=null}if(!b||!b.documentElement||b.getElementsByTagName("parsererror").length)throw new SyntaxError(SDV.Localization.getResource("wrongParameterFormatError")({parameterName:"xmlString",actualValue:a,expectedFormat:"XML"}));return b},stringify:function(a){if(!SDV.Util.Xml.isXml(a))throw new TypeError(SDV.Localization.getResource("wrongParameterTypeError")({parameterName:"xmlObject",actualValue:a,expectedType:"[object XMLDocument]"}));var b=null;try{window.XMLSerializer?b=(new window.XMLSerializer).serializeToString(a):window.ActiveXObject&&"undefined"!=typeof a.getElementsByTagName&&SDV.Util.String.isString(a.xml)&&(b=a.xml)}catch(c){throw new SyntaxError(SDV.Localization.getResource("wrongParameterFormatError")({parameterName:"xmlObject",actualValue:a,expectedFormat:"XML"}))}if(null===b)throw new Error(SDV.Localization.getResource("unsupportedFacilityError")(["XMLSerializer","ActiveXObject('Microsoft.XMLDOM')"]));return b},getFromFile:function(a){return SDV.Util.Ajax.makeRequest({url:a.filePath,method:"GET",async:a.async,timeout:a.timeout,responseContentType:"document",onSuccess:a.onSuccess,onError:a.onError})}},SDV.Util.Ajax={},function(){var a=["GET","POST","PUT","DELETE"],b={url:"",method:"GET",timeout:0,async:!0,user:"",password:"",headers:{},requestContent:null,requestContentType:"application/x-www-form-urlencoded",responseContentType:"",onSuccess:function(a,b){console.log(b.responseText)},onError:function(a){console.error(a.message)}},c=function(c){var d={optionName:"onError",allowedTypes:["Function"],replaceWithDefaultIfUndefined:!0,replaceWithDefaultIfInvalid:!0},e={optionName:"onSuccess",isRequired:!0,allowedTypes:["Function"]},f={optionName:"url",isRequired:!0,allowedTypes:["String"]},g={optionName:"method",allowedTypes:["String"],allowedValues:a,replaceWithDefaultIfUndefined:!0},h={optionName:"user",allowedTypes:["String"],replaceWithDefaultIfUndefined:!0},i={optionName:"password",allowedTypes:["String"],replaceWithDefaultIfUndefined:!0},j={optionName:"timeout",allowedTypes:["Integer"],minValue:0,minValueEqualityAllowed:!0,replaceWithDefaultIfUndefined:!0},k={optionName:"async",allowedTypes:["Boolean"],replaceWithDefaultIfUndefined:!0},l={optionName:"requestContent",replaceWithDefaultIfUndefined:!0},m={optionName:"headers",allowedTypes:["Object"],replaceWithDefaultIfUndefined:!0},n={optionName:"requestContentType",allowedTypes:["String"],replaceWithDefaultIfUndefined:!0},o={optionName:"responseContentType",allowedTypes:["String"],replaceWithDefaultIfUndefined:!0},p=SDV.Util.Validation.validateOptions([d,e,f,g,h,i,j,k,l,m,n,o],c,b);return p},d=function(a){if(SDV.Util.String.isString(a)){var b=window.location,c=document.createElement("a");if(c.href=a,""!==c.protocol&&b.protocol!==c.protocol)return!0;if(""!==c.hostname&&b.hostname!==c.hostname)return!0;if(""!==c.port&&b.port!==c.port)return!0}return!1},e=function(){var a=null,b=!document.addEventListener||!document.querySelector;if(!window.ActiveXObject||window.XMLHttpRequest&&!b)window.XMLHttpRequest&&(a=new window.XMLHttpRequest);else for(var c=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"],d=0,e=c.length;e>d;d++)try{a=new window.ActiveXObject(c[d])}catch(f){}return a},f=function(a){SDV.Util.String.isString(a.method)&&(a.method=SDV.Util.String.trim(a.method).toUpperCase()),SDV.Util.String.isString(a.requestContentType)&&(a.requestContentType=SDV.Util.String.trim(a.requestContentType).toLowerCase()),SDV.Util.String.isString(a.responseContentType)&&(a.responseContentType=SDV.Util.String.trim(a.responseContentType).toLowerCase());var b=c(a);if(!b.isValid)return a.onError({name:"AjaxOptionsError",message:b.message}),null;var f=e();if(!f)return a.onError({name:"AjaxOptionsError",message:SDV.Localization.getResource("unsupportedFacilityError")(["XMLHttpRequest","ActiveXObject('Msxml2.XMLHTTP')","ActiveXObject('Microsoft.XMLHTTP')"])}),null;var g="undefined"!=typeof f.withCredentials,h=null;if(d(a.url)&&!g){if(!window.XDomainRequest)return a.onError({name:"AjaxOptionsError",message:SDV.Localization.getResource("unsupportedFacilityError")("XDomainRequest")}),null;h=new window.XDomainRequest}var i,j=h||f,k=!0,l=!1,m=function(){i&&(clearTimeout(i),i=null,l||(l=!0,j.abort()))},n=function(){k=!1,m(),a.onError({name:"RequestTimeOut",message:"Request is timed out ("+a.timeout+"ms)."},j)},o=function(b){l=!0,m(),k&&("undefined"!=typeof b?a.onError({name:b.name||"RequestError",message:b.message||b},j):a.onError({name:j.statusText||"RequestError",message:(j.status?"Error "+(1223==j.status?204:j.status)+" ":"Error. ")+(j.statusText?"("+j.statusText+"). ":"")+(j.responseText?j.responseText:"")},j))},p=function(){l=!0,m();var b=null;try{b="json"===a.responseContentType?SDV.Util.Json.parse(j.responseText):"document"===a.responseContentType?SDV.Util.Xml.parse(j.responseText):j.responseText}catch(c){b=j.responseText}a.onSuccess(b,j)},q=function(){var a,b=0;try{if(4!==f.readyState)return;l=!0,b=f.status}catch(c){b=0,a=c}200===b?p():o(a)};if(SDV.Util.Object.isObject(a.requestContent)&&"GET"===a.method){-1==a.url.indexOf("?")&&(a.url=a.url+"?");var r=!1;for(var s in a.requestContent)a.requestContent.hasOwnProperty(s)&&(r&&(a.url=a.url+"&"),a.url=a.url+s+"="+a.requestContent[s],r=!0)}if(a.timeout>0&&(i=setTimeout(n,a.timeout)),j===f){a.async&&(f.onreadystatechange=q),f.open(a.method,a.url,a.async,a.user,a.password);for(var t in a.headers)a.headers.hasOwnProperty(t)&&f.setRequestHeader(t,a.headers[t]);"GET"===a.method?f.send(null):(f.setRequestHeader("Content-type",a.requestContentType),f.send(a.requestContent)),a.async||q()}else h.open(a.method,a.url),h.onload=p,h.onerror=o,h.send("GET"===a.method?null:a.requestContent);return j};SDV.Util.Ajax.makeRequest=f,SDV.Util.Ajax.isUrlCrossDomain=d}(),SDV.Util.Geojson={},function(){var a=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],b=(a.concat(["GeometryCollection","Feature","FeatureCollection"]),function(a,b,c,d){d=d||"geoObject";var e=["Object"];b&&e.push("Null");var f=SDV.Util.Validation.validateOption({optionName:d,isRequired:!0,allowedTypes:e},a);return f.isValid?f=SDV.Util.Validation.validateOptions([{optionName:"type",optionFullName:d+".type",isRequired:!0,allowedTypes:["String"],allowedValues:c},{optionName:"bbox",optionFullName:d+".bbox",isRequired:!1,allowedTypes:["NumberArray"],postValidationMethod:function(a){var b={isValid:!0,message:""};return SDV.Util.Number.isOdd(a.length)&&(b.isValid=!1,b.message=SDV.Localization.getResource("wrongParameterValueError")({parameterName:d+".bbox.length",allowedValues:"2*n, n > 0",actualValue:a.length})),b},postValidationMethodOptions:a.bbox}],a):f}),c=function(a,b){b=b||"geoObject";var c=SDV.Util.Validation.validateOption({optionName:b,isRequired:!0,allowedTypes:["Object"]},a);return c.isValid?c=SDV.Util.Validation.validateOptions([{optionName:"crs",optionFullName:b+".crs",isRequired:!1,allowedTypes:["Null","Object"],postValidationMethod:function(a){var c={isValid:!0,message:""};if(null!==a){if(c=SDV.Util.Validation.validateOptions([{optionName:"type",optionFullName:b+".crs.type",isRequired:!0,allowedTypes:["String"],allowedValues:["name","link"]},{optionName:"properties",optionFullName:b+".crs.properties",isRequired:!0,allowedTypes:["Object"]}],a),!c.isValid)return c;"link"===a.type?c=SDV.Util.Validation.validateOptions([{optionName:"href",optionFullName:b+".crs.properties.href",isRequired:!0,allowedTypes:["String"]},{optionName:"type",optionFullName:b+".crs.properties.type",isRequired:!1,allowedTypes:["String"]}],a.properties):"name"===a.type&&(c=SDV.Util.Validation.validateOptions([{optionName:"name",optionFullName:b+".crs.properties.name",isRequired:!0,allowedTypes:["String"]}],a.properties))}return c},postValidationMethodOptions:a.crs}],a):c},d=function(c,d,e){e=e||"geoObject";var f=b(c,d,a,e);return f.isValid?f=SDV.Util.Validation.validateOptions([{optionName:"coordinates",optionFullName:e+".coordinates",isRequired:!0,allowedTypes:["Array"]}],c):f},e=function(a,c){c=c||"geoObject";var e=b(a,!1,["GeometryCollection"],c);return e.isValid?e=SDV.Util.Validation.validateOptions([{optionName:"geometries",optionFullName:c+".geometries",isRequired:!0,allowedTypes:["Array"],postValidationMethod:function(a){for(var b={isValid:!0,message:""},e=0,f=a.length;f>e;e++)if(b=d(a[e],!1,c+".geometries["+e+"]"),!b.isValid)return b;return b},postValidationMethodOptions:a.geometries}],a):e},f=function(a,c){c=c||"geoObject";var e=b(a,!1,["Feature"],c);return e.isValid?(e=d(a.geometry,!0,c+".geometry"),e.isValid?e=SDV.Util.Validation.validateOption({optionName:"properties",fullOptionName:c+".properties",isRequired:!0,allowedTypes:["Null","Object"]},a):e):e},g=function(a,c){c=c||"geoObject";var d=b(a,!1,["FeatureCollection"],c);return d.isValid?d=SDV.Util.Validation.validateOptions([{optionName:"features",optionFullName:c+".features",isRequired:!0,allowedTypes:["Array"],postValidationMethod:function(a){for(var b={isValid:!0,message:""},d=0,e=a.length;e>d;d++)if(b=f(a[d],c+".features["+d+"]"),!b.isValid)return b;return b},postValidationMethodOptions:a.features}],a):d},h={Point:d,MultiPoint:d,LineString:d,MultiLineString:d,Polygon:d,MultiPolygon:d,GeometryCollection:e,Feature:f,FeatureCollection:g},i=function(a,d){var e="geoJsonObject",f=SDV.Util.Object.getPropertiesNames(h),g=SDV.Util.Validation.validateOption({optionName:"allowedGeoObjectTypes",isRequired:!1,allowedTypes:["StringArray"],postValidationMethod:function(){var a={isValid:!0,message:""};if("undefined"!=typeof d)for(var b=0,c=d.length;c>b;b++)if(a=SDV.Util.Validation.validateOption({optionName:"allowedGeoObjectTypes["+b+"]",isRequired:!0,allowedTypes:["String"],allowedValues:f},d[b]),!a.isValid)return a;return a}},d);return g.isValid?(g=b(a,!1,f,e),g.isValid?(h.hasOwnProperty(a.type)?g=h[a.type](a,e):(g=!1,g.message=SDV.Localization.getResource("wrongParameterValueError")({parameterName:e+".type",actualValue:a.type,allowedValues:f})),g.isValid?g=c(a,e):g):g):g},j=function(a){return i(a).isValid},k=function(b,c){var d=[];if(c=c!==!1){var e=i(b);e.isValid||console.error(e.message)}return SDV.Util.Array.contains(a,b.type)||"Feature"===b.type?d.push(b):"GeometryCollection"===b.type?d=b.geometries:"FeatureCollection"===b.type&&(d=b.features),d};SDV.Util.Geojson.validate=i,SDV.Util.Geojson.isGeojson=j,SDV.Util.Geojson.getGeoObjects=k}(),SDV.Localization={},function(){var a="en",b=a,c={},d=0,e=function(d,g){var h=undefined;return d!=undefined&&(SDV.Util.String.isString(d)?(h=c[d],h==undefined&&console.error(f("missingDictionaryError",b)(d))):console.error(f("wrongParameterTypeError",b)({parameterName:"locale",actualValue:d,expectedType:"[object String]"}))),h==undefined&&g&&d!==b&&(h=e(b)),h==undefined&&g&&b!=a&&d!==a&&(h=e(a)),h},f=function(a,c){var d=undefined;if(SDV.Util.String.isString(a)){var g=e(c,!0)||{};d=g[a]}else console.error(f("wrongParameterTypeError",b)({parameterName:"resourceName",actualValue:a,expectedType:"[object String]"}));return d},g=function(e,g){if(!SDV.Util.Object.isObject(g))return console.error(f("wrongParameterTypeError",b)({parameterName:"dictionary",actualValue:g,expectedType:"[object Object]"})),!1;if(!SDV.Util.String.isString(e))return console.error(f("wrongParameterTypeError",b)({parameterName:"locale",actualValue:e,expectedType:"[object String]"})),!1;var h=c[e];return h!=undefined?SDV.Util.Object.extend(h,g):c[e]=g,0==d&&(a=b=e),d++,!0},h=function(){return b},i=function(){return a},j=function(a){e(a)!=undefined&&(b=a)},k=function(a){if(!SDV.Util.Object.isObject(a))return console.error(f("wrongParameterTypeError",b)({parameterName:"options",actualValue:a,expectedType:"[object Object]"})),!1;var c=g(a.locale,a.dictionary);return c&&a.setAsCurrent&&j(a.locale),c};SDV.Localization.getResource=f,SDV.Localization.getDefaultLanguage=i,SDV.Localization.getCurrentLanguage=h,SDV.Localization.setCurrentLanguage=j,SDV.Localization.extend=k}(),SDV.Localization.extend({locale:"ru",dictionary:{greeting:"Привет, мир!",missingDictionaryError:function(a){return"Ошибка. Не найден словарь локализации для языка '"+a+"'."},wrongColorRepresentation:function(a){return"Ошибка. Не удалось найти цвет, которому соответствовало бы строковое представление '"+a+"'."},wrongParameterTypeError:function(a){return a=a||{},"Ошибка. Параметр '"+a.parameterName+"' должен иметь один из следующих разрешенных типов: "+(SDV.Util.Array.isArray(a.expectedType)?"'"+a.expectedType.join("', '")+"'":"'"+a.expectedType+"'")+". Тип '"+Object.prototype.toString.call(a.actualValue)+"' не является разрешенным для этого параметра."},wrongParameterFormatError:function(a){return a=a||{},"Ошибка. Параметер '"+a.parameterName+"' имеет неверный формат ("+a.actualValue+"). Он должен соответствовать формату '"+a.expectedFormat+"'."},wrongParameterValueError:function(a){return a=a||{},"Ошибка. Параметр '"+a.parameterName+"' должен иметь одно из следующих разрешенных значений: "+(SDV.Util.Array.isArray(a.allowedValues)?"'"+a.allowedValues.join("', '")+"'":"'"+a.allowedValues+"'")+". Значение '"+a.actualValue+"' не является разрешенным для этого параметра."},missingRequiredParameter:function(a){return"Ошибка. Не задан обязательный параметр '"+a+"'."},unsupportedFacilityError:function(a){return"Ошибка. Ваш браузер не поддерживает "+(SDV.Util.Array.isArray(a)?"ни одну из следующих возможностей: "+a.join(", "):a)+"."},syntaxError:function(a){return"Синтаксическая ошибка в строке '"+a.originalString+"' на позиции №"+a.errorPosition+". Ожидается одня из следующих конструкций: "+(SDV.Util.Array.isArray(a.allowedConstructions)?"'"+a.allowedConstructions.join("', '")+"'":"'"+a.allowedConstructions+"'")+". Конструкция '"+a.actualConstruction+"' не является разрешенной."}}}),SDV.Localization.extend({locale:"en",setAsCurrent:!0,dictionary:{greeting:"Hello, world!",missingDictionaryError:function(a){return"Error. There is no dictionary for '"+a+"' language."},wrongColorRepresentation:function(a){return"Error. There is no color with such '"+a+"' stringed representation."},wrongParameterTypeError:function(a){return a=a||{},"Error. Parameter '"+a.parameterName+"' must have one of the following types: "+(SDV.Util.Array.isArray(a.expectedType)?"'"+a.expectedType.join("', '")+"'":"'"+a.expectedType+"'")+". Type '"+Object.prototype.toString.call(a.actualValue)+"' is not allowed."},wrongParameterFormatError:function(a){return a=a||{},"Error. Parameter '"+a.parameterName+"' has invalid format ("+a.actualValue+"). It must have valid '"+a.expectedFormat+"' format."},wrongParameterValueError:function(a){return a=a||{},"Error. Parameter '"+a.parameterName+"' must have one of the following values: "+(SDV.Util.Array.isArray(a.allowedValues)?"'"+a.allowedValues.join("', '")+"'":"'"+a.allowedValues+"'")+". Value '"+a.actualValue+"' is not allowed."},missingRequiredParameterError:function(a){return"Error. Required parameter '"+a+"' is undefined."},unsupportedFacilityError:function(a){return"Error. Your browser doesn't support "+(SDV.Util.Array.isArray(a)?"any of the following facilities: "+a.join(", "):a)+"."},syntaxError:function(a){return"Syntax error in '"+a.originalString+"', at position №"+a.errorPosition+". One of the following constructions expected: "+(SDV.Util.Array.isArray(a.allowedConstructions)?"'"+a.allowedConstructions.join("', '")+"'":"'"+a.allowedConstructions+"'")+". Construction '"+a.actualConstruction+"' is not allowed."}}}),SDV.Enumerable={},function(){var a=function(a){this._items=a};SDV.Enumerable.create=function(b){return SDV.Util.Array.isArray(b)?new a(b):(console.error(SDV.Localization.getResource("wrongParameterTypeError")({parameterName:"items",expectedType:"[object Array]",actualValue:b})),null)},SDV.Enumerable.isEnumerable=function(b){return b instanceof a};var b=SDV.Enumerable.prototype=a.prototype={};b.push=function(a){return this._items.push(a)},b.pop=function(a){return this._items.pop(a)},b.toArray=function(){return this._items},b.select=function(b){var c,d=[];if(SDV.Util.Function.isFunction(b)){var e=0;for(this._items.length;e<this._items.length;e++)c=this._items[e],d.push(b(c,e))}return new a(d)},b.where=function(b){var c,d=[];if(SDV.Util.Function.isFunction(b)){var e=0;for(this._items.length;e<this._items.length;e++)c=this._items[e],b(c,e)===!0&&d.push(c)}return new a(d)},b.any=function(a){var b;if(SDV.Util.Function.isFunction(a)){var c=0;for(this._items.length;c<this._items.length;c++)if(b=this._items[c],a(b,c))return!0}return!1},b.all=function(a){var b;if(SDV.Util.Function.isFunction(a)){var c=0;for(this._items.length;c<this._items.length;c++)if(b=this._items[c],!a(b,c))return!1}return!0},b.first=function(a){var b;if(!SDV.Util.Function.isFunction(a))return this._items.length>0?this._items[0]:null;var c=0;for(this._items.length;c<this._items.length;c++)if(b=this._items[c],a(b,c))return b},b.firstOrDefault=function(a,b){return this.first(a)||b},b.last=function(a){var b;if(!SDV.Util.Function.isFunction(a))return this._items.length>0?this._items[this._items.length-1]:null;for(var c=this._items.length-1;c>=0;c--)if(b=this._items[c],a(b,c))return b},b.lastOrDefault=function(a,b){return this.last(a)||b},b.elementAt=function(a){return this._items[a]},b.elementAtOrDefault=function(a,b){return this.elementAt(a)||b},b.count=function(a){return SDV.Util.Function.isFunction(a)?this.where(a).items.length:this._items.length},b.concat=function(b){var c=[];return b instanceof a?c=b.items:SDV.Util.Array.isArray(b)&&(c=b),new a(this._items.concat(c))},b.orderBy=function(b){var c=[].concat(this._items);return new a(SDV.Util.Function.isFunction(b)?c.sort(function(a,c){var d=b(a),e=b(c);return e>d?-1:d>e?1:0}):c)},b.orderByDescending=function(b){var c=[].concat(this._items);return new a(SDV.Util.Function.isFunction(b)?c.sort(function(a,c){var d=b(c),e=b(a);return e>d?-1:d>e?1:0}):c)}}(),SDV.Condition={parse:function(a){var b={isValid:!0,message:"",templates:null},c=SDV.Util.Validation.validateOption({optionName:"condition",isRequired:!0,allowedTypes:["String"]},a);if(b.isValid=c.isValid,b.message=c.message,!b.isValid)return b;var d=a.length,e=[],f=a.replace(/'(.*?)'|"(.*?)"/g,function(a){return"'"+new Array(a.length-1).join("_")+"'"}),g=[];f.replace(/{{/g,function(a,b){return g.push(b),a});for(var h=-1,i=-1,j=0,k="",l=/^{{(.*?)}}$/g,m=0,n=g.length;n>m;m++){if(h=g[m],i=f.indexOf("}}",h+1),i=i>0?i+1:f.indexOf("{{",h+1)+1,i=i>0?i:d-1,j=i-h+1,k=a.substr(h,j),!k.match(l))return b.isValid=!1,b.message=SDV.Localization.getResource("syntaxError")({originalString:a,allowedConstructions:["{{propertyName}}","{{propertyName1.propertyName2...}}"],actualConstruction:k,errorPosition:h}),b;e.push({start:h,end:i,propertyName:k.substr(2,j-4)})}var o=[];for(f.replace(/}}/g,function(a,b){return o.push(b),a}),m=0,n=o.length;n>m;m++)if(i=o[m]+1,k=f.substr(0,i+1),h=k.lastIndexOf("{{"),h=h>=0?h:k.substr(0,k.length-2).lastIndexOf("}}"),h=h>=0?h:0,j=i-h+1,k=a.substr(h,j),!k.match(l))return b.isValid=!1,b.message=SDV.Localization.getResource("syntaxError")({originalString:a,allowedConstructions:["{{propertyName}}","{{propertyName1.propertyName2...}}"],actualConstruction:k,errorPosition:h}),b;return b.templates=e,b}},function(){var Condition=function(a,b){this._condition=a,this._templates=b};SDV.Condition.create=function(a){var b=null,c=SDV.Util.Validation.validateOption({optionName:"condition",isRequired:!0,allowedTypes:["String"],postValidationMethod:function(){return b=SDV.Condition.parse(a)}},a);return c.isValid?b&&b.templates?new Condition(a,b.templates):null:(console.error(c.message),null)},SDV.Condition.isCondition=function(a,b){return a instanceof Condition||b===!0&&SDV.Condition.parse(a).isValid};var condition=SDV.Condition.prototype=Condition.prototype={};condition.getSatisfyingData=function(data,tillFirstSatisfaction){var dataValidationResult=SDV.Util.Validation.validateOption({optionName:"data",isRequired:!0,allowedTypes:["Object","ObjectArray"]},data);if(!dataValidationResult.isValid)throw new Error(dataValidationResult.message);tillFirstSatisfaction=tillFirstSatisfaction===!0;for(var satisfyingDataObjects=[],templates=this._templates,templatesDataObjects=SDV.Util.Array.isArray(data)?data:[data],i=0,templatesDataObjectsCount=templatesDataObjects.length;templatesDataObjectsCount>i;i++){for(var templateOffset=0,currentCondition=this._condition,j=0,templatesCount=templates.length;templatesCount>j;j++){var template=templates[j],templateDataObject=templatesDataObjects[i],templatePropertyName=template.propertyName,templatePropertyValue=SDV.Util.Object.getPropertyValue({srcObject:templateDataObject,propertyName:templatePropertyName});templatePropertyValue="undefined"!=typeof templatePropertyValue?SDV.Util.Json.stringify(templatePropertyValue):"undefined",currentCondition=SDV.Util.String.insert(currentCondition,templatePropertyValue,template.start+templateOffset,template.end+templateOffset),templateOffset+=templatePropertyValue.length-(template.end-template.start+1)}if(eval(currentCondition)===!0&&(satisfyingDataObjects.push(templatesDataObjects[i]),tillFirstSatisfaction))break}return satisfyingDataObjects},condition.isSatisfiedBy=function(a){return this.getSatisfyingData(a,!0).length>0}}(),SDV.Color={},function(){var a=function(a){this._rgb=SDV.Color.Model.Rgb.create(a)};SDV.Color.create=function(b){var c=b,d=SDV.Util.Validation.validateOption({optionName:"colorDefinition",isRequired:!0,allowedTypes:["Object","String"],postValidationMethod:function(){var a={isValid:!0,message:""};if(SDV.Util.Object.isObject(b)&&(SDV.Util.Function.isFunction(b.toHex)?c=b.toHex():(a.isValid=!1,a.message=SDV.Localization.getResource("wrongParameterTypeError")({parameterName:"colorDefinition.toHex",expectedType:"[object Function]",actualValue:b.toHex}))),!a.isValid)return a;var d=SDV.Color.Model.Hex.isHex(c),e=SDV.Color.Model.Hex.Code.hasOwnProperty(c);return d||e||(a.isValid=!1,a.message=SDV.Localization.getResource("wrongColorRepresentation")(c)),a}},b);return d.isValid?new a(c):(console.error(d.message),null)},SDV.Color.isColor=function(b){
return b instanceof a};var b=SDV.Color.prototype=a.prototype={};b.red=function(a){var b=this._rgb.red(a);return SDV.Color.Model.Rgb.isRgb(b)?this:b},b.green=function(a){var b=this._rgb.green(a);return SDV.Color.Model.Rgb.isRgb(b)?this:b},b.blue=function(a){var b=this._rgb.blue(a);return SDV.Color.Model.Rgb.isRgb(b)?this:b},b.hue=function(a){var b=this.toHsb().hue(a),c=!1;return SDV.Color.Model.Hsb.isHsb(b)&&(c=!0,this._rgb=b.toRgb()),c?this:b},b.saturation=function(a){var b=this.toHsb().saturation(a),c=!1;return SDV.Color.Model.Hsb.isHsb(b)&&(c=!0,this._rgb=b.toRgb()),c?this:b},b.brightness=function(a){var b=this.toHsb().brightness(a),c=!1;return SDV.Color.Model.Hsb.isHsb(b)&&(c=!0,this._rgb=b.toRgb()),c?this:b},b.lightness=function(a){var b=this.toHsl().lightness(a),c=!1;return SDV.Color.Model.Hsl.isHsl(b)&&(c=!0,this._rgb=b.toRgb()),c?this:b},b.allComponents=function(){return{red:this.red(),green:this.green(),blue:this.blue(),hue:this.hue(),saturation:this.saturation(),brightness:this.brightness(),lightness:this.lightness()}},b.distanceTo=function(a){if(!SDV.Color.isColor(a))return null;var b=this.toHsb(),c=a.toHsb();return b.distanceTo(c)},b.toHex=function(){return this._rgb.toHex()},b.toRgb=function(){return this._rgb.clone()},b.toHsl=function(){return this._rgb.toHsl()},b.toHsb=function(){return this._rgb.toHsb()},b.clone=function(){return SDV.Color.create(this.toHex())},b.equals=function(a,b){if(!SDV.Color.isColor(a))return!1;(!SDV.Util.Number.isNumber(b)||0>b)&&(b=0),b>1&&(b=1);var c=!1;return c=0==b?this._rgb.equals(a._rgb):!(this.distanceTo(a)>b)}}(),function(){var a=.06,b={monochrome:[0,0],random:[0,1]},c=.1,d={monochrome:[0,0],pale:[.3,.7],rich:[.7,1],random:[0,1]},e=.1,f={monochrome:[0,1],dark:[.1,.5],bright:[.5,1],random:[0,1]},g=function(a){return SDV.Util.String.isString(a)&&(SDV.Color.Model.Hex.isHex(a)||SDV.Color.Model.Hex.Code.hasOwnProperty(a))},h=function(a){if(!g(a))return!1;var b=SDV.Color.Model.Hsb.create(a),c=b.saturation(),d=b.brightness(),e=[0,.3],f=[0,.1];return!!(c>=e[0]&&c<=e[1]||d>=f[0]&&d<=f[1])},i=function(a){var b=a.componentName,c=a.componentValue,d=a.keywords,e={isValid:!0,message:""};if(SDV.Util.String.isString(c)){var f=SDV.Util.Array.contains(d,c),h=g(c);f||h||(e.isValid=!1,e.message=SDV.Localization.getResource("wrongColorRepresentation")(c))}else SDV.Util.Number.isNumber(c)&&(e=SDV.Util.Validation.validateOption({optionName:b,optionFullName:"options."+b,isRequired:!0,allowedTypes:["Number"],minValue:0,minValueEqualityAllowed:!0,maxValue:1,maxValueEqualityAllowed:!0},c));return e},j=function(a,c){return SDV.Util.Validation.validateOptions([{optionName:"count",optionFullName:"options.count",isRequired:!1,allowedTypes:["Integer"],minValue:0,minValueEqualityAllowed:!0,replaceWithDefaultIfUndefined:!1},{optionName:"hue",optionFullName:"options.hue",isRequired:!1,allowedTypes:["String","Number"],postValidationMethod:i,postValidationMethodOptions:{componentName:"hue",componentValue:a.hue,keywords:SDV.Util.Object.getPropertiesNames(b)},replaceWithDefaultIfUndefined:!0},{optionName:"saturation",optionFullName:"options.saturation",isRequired:!1,allowedTypes:["String","Number"],postValidationMethod:i,postValidationMethodOptions:{componentName:"saturation",componentValue:a.saturation,keywords:SDV.Util.Object.getPropertiesNames(d)},replaceWithDefaultIfUndefined:!0},{optionName:"brightness",optionFullName:"options.brightness",isRequired:!1,allowedTypes:["String","Number"],postValidationMethod:i,postValidationMethodOptions:{componentName:"brightness",componentValue:a.brightness,keywords:SDV.Util.Object.getPropertiesNames(f)},replaceWithDefaultIfUndefined:!0}],a,c)},k=function(a,b,c,d){if(SDV.Util.Number.isNumber(b))return[b,b];if(c[b])return c[b];var e=SDV.Color.Model.Hsb.create(b)[a]();return[e-d,e+d]},l=function(a){return Math.random()*(a[1]-a[0])+a[0]},m=function(a){var b=l(a.hueRange);b=0>b?1-b:b,0>b&&(b=1-b),b>1&&(b-=1);var c=l(a.saturationRange);0>c&&(c=0),c>1&&(c=1);var d=l(a.brightnessRange);return 0>d&&(d=0),d>1&&(d=1),SDV.Color.Model.Hsb.create({hue:b,saturation:c,brightness:d}).toHex()},n=function(g){g=g||{};var i={count:undefined,hue:"random",saturation:"rich",brightness:"bright"},l=j(g,i);if(!l.isValid)return console.error(l.message),null;var n=h(g.hue)?"monochrome":g.hue,o={hueRange:k("hue",n,b,a),saturationRange:"monochrome"===n?d.monochrome:k("saturation",g.saturation,d,c),brightnessRange:"monochrome"===n?f.monochrome:k("brightness",g.brightness,f,e)};if("undefined"!=typeof g.count){for(var p=[],q=0;q<g.count;q++)p.push(m(o));return p}return m(o)};SDV.Color.random=n}(),SDV.Color.Model={},SDV.Color.Model.Hex={Code:{black:"#000000",navy:"#000080",darkblue:"#00008b",mediumblue:"#0000cd",blue:"#0000ff",darkgreen:"#006400",green:"#008000",teal:"#008080",darkcyan:"#008b8b",deepskyblue:"#00bfff",darkturquoise:"#00ced1",mediumspringgreen:"#00fa9a",lime:"#00ff00",springgreen:"#00ff7f",aqua:"#00ffff",cyan:"#00ffff",midnightblue:"#191970",dodgerblue:"#1e90ff",lightseagreen:"#20b2aa",forestgreen:"#228b22",seagreen:"#2e8b57",darkslategrey:"#2f4f4f",darkslategray:"#2f4f4f",limegreen:"#32cd32",mediumseagreen:"#3cb371",turquoise:"#40e0d0",royalblue:"#4169e1",steelblue:"#4682b4",darkslateblue:"#483d8b",mediumturquoise:"#48d1cc",indigo:"#4b0082",darkolivegreen:"#556b2f",cadetblue:"#5f9ea0",cornflowerblue:"#6495ed",mediumaquamarine:"#66cdaa",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6a5acd",olivedrab:"#6b8e23",slategrey:"#708090",slategray:"#708090",lightslategrey:"#778899",lightslategray:"#778899",mediumslateblue:"#7b68ee",lawngreen:"#7cfc00",chartreuse:"#7fff00",aquamarine:"#7fffd4",maroon:"#800000",purple:"#800080",olive:"#808000",gray:"#808080",grey:"#808080",skyblue:"#87ceeb",lightskyblue:"#87cefa",blueviolet:"#8a2be2",darkred:"#8b0000",darkmagenta:"#8b008b",saddlebrown:"#8b4513",darkseagreen:"#8fbc8f",lightgreen:"#90ee90",mediumpurple:"#9370db",darkviolet:"#9400d3",palegreen:"#98fb98",darkorchid:"#9932cc",yellowgreen:"#9acd32",sienna:"#a0522d",brown:"#a52a2a",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",lightblue:"#add8e6",greenyellow:"#adff2f",paleturquoise:"#afeeee",lightsteelblue:"#b0c4de",powderblue:"#b0e0e6",firebrick:"#b22222",darkgoldenrod:"#b8860b",mediumorchid:"#ba55d3",rosybrown:"#bc8f8f",darkkhaki:"#bdb76b",silver:"#c0c0c0",mediumvioletred:"#c71585",indianred:"#cd5c5c",peru:"#cd853f",chocolate:"#d2691e",tan:"#d2b48c",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",thistle:"#d8bfd8",orchid:"#da70d6",goldenrod:"#daa520",palevioletred:"#db7093",crimson:"#dc143c",gainsboro:"#dcdcdc",plum:"#dda0dd",burlywood:"#deb887",lightcyan:"#e0ffff",lavender:"#e6e6fa",darksalmon:"#e9967a",violet:"#ee82ee",palegoldenrod:"#eee8aa",lightcoral:"#f08080",khaki:"#f0e68c",aliceblue:"#f0f8ff",honeydew:"#f0fff0",azure:"#f0ffff",sandybrown:"#f4a460",wheat:"#f5deb3",beige:"#f5f5dc",whitesmoke:"#f5f5f5",mintcream:"#f5fffa",ghostwhite:"#f8f8ff",salmon:"#fa8072",antiquewhite:"#faebd7",linen:"#faf0e6",lightgoldenrodyellow:"#fafad2",oldlace:"#fdf5e6",red:"#ff0000",magenta:"#ff00ff",fuchsia:"#ff00ff",deeppink:"#ff1493",orangered:"#ff4500",tomato:"#ff6347",hotpink:"#ff69b4",coral:"#ff7f50",darkorange:"#ff8c00",lightsalmon:"#ffa07a",orange:"#ffa500",lightpink:"#ffb6c1",pink:"#ffc0cb",gold:"#ffd700",peachpuff:"#ffdab9",navajowhite:"#ffdead",moccasin:"#ffe4b5",bisque:"#ffe4c4",mistyrose:"#ffe4e1",blanchedalmond:"#ffebcd",papayawhip:"#ffefd5",lavenderblush:"#fff0f5",seashell:"#fff5ee",cornsilk:"#fff8dc",lemonchiffon:"#fffacd",floralwhite:"#fffaf0",snow:"#fffafa",yellow:"#ffff00",lightyellow:"#ffffe0",ivory:"#fffff0",white:"#ffffff"}},function(){var a=function(a){try{return a.toLowerCase().replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,c,d){return"#"+b+b+c+c+d+d})}catch(b){return null}},b=function(a){a.toLowerCase();return SDV.Color.Model.Hex.Code.hasOwnProperty(a)?SDV.Color.Model.Hex.Code[a]:null};SDV.Color.Model.Hex.create=function(c){var d,e=!1,f=SDV.Util.Validation.validateOption({optionName:"colorDefinition",isRequired:!0,allowedTypes:["String"],postValidationMethod:function(){var a={isValid:!0,message:""};return d=SDV.Color.Model.Hex.isHex(c),e=SDV.Color.Model.Hex.Code.hasOwnProperty(c),d||e||(a.isValid=!1,a.message=SDV.Localization.getResource("wrongColorRepresentation")(c)),a}},c);return f.isValid?d?a(c):e?b(c):null:(console.error(f.message),null)},SDV.Color.Model.Hex.isHex=function(a){return SDV.Util.String.isString(a)&&a.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)}}(),SDV.Color.Model.Rgb={},function(){var a=function(a){this._red=a.red,this._green=a.green,this._blue=a.blue},b=function(b){var c=SDV.Color.Model.Hex.create(b),d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c);return d?new a({red:parseInt(d[1],16),green:parseInt(d[2],16),blue:parseInt(d[3],16)}):null};SDV.Color.Model.Rgb.create=function(c){var d,e,f=!1,g=SDV.Util.Validation.validateOption({optionName:"colorDefinition",isRequired:!0,allowedTypes:["Object","String"],postValidationMethod:function(){var a={isValid:!0,message:""};return SDV.Util.String.isString(c)?(d=SDV.Color.Model.Hex.isHex(c),e=SDV.Color.Model.Hex.Code.hasOwnProperty(c),d||e||(a.isValid=!1,a.message=SDV.Localization.getResource("wrongColorRepresentation")(c))):(f=!0,a=SDV.Util.Validation.validateOptions([{optionName:"red",optionFullName:"colorDefinition.red",isRequired:!0,allowedTypes:["Integer"],minValue:0,minValueEqualityAllowed:!0,maxValue:255,maxValueEqualityAllowed:!0},{optionName:"green",optionFullName:"colorDefinition.green",isRequired:!0,allowedTypes:["Integer"],minValue:0,minValueEqualityAllowed:!0,maxValue:255,maxValueEqualityAllowed:!0},{optionName:"blue",optionFullName:"colorDefinition.blue",isRequired:!0,allowedTypes:["Integer"],minValue:0,minValueEqualityAllowed:!0,maxValue:255,maxValueEqualityAllowed:!0}],c)),a}},c);return g.isValid?d||e?b(c):f?new a(c):null:(console.error(g.message),null)},SDV.Color.Model.Rgb.isRgb=function(b){return b instanceof a};var c=function(a,b,c){var d=SDV.Util.Validation.validateOption({optionName:"channelValue",isRequired:!1,allowedTypes:["Integer"],minValue:0,minValueEqualityAllowed:!0,maxValue:255,maxValueEqualityAllowed:!0},c);if(!d.isValid)return console.error(d.message),a;var e="_"+b;return d.isDefined?(a[e]=c,a):a[e]},d=SDV.Color.Model.Rgb.prototype=a.prototype={};d.red=function(a){return c(this,"red",a)},d.green=function(a){return c(this,"green",a)},d.blue=function(a){return c(this,"blue",a)},d.distanceTo=function(a){if(!SDV.Color.Model.Rgb.isRgb(a))return null;var b=(a._red-this._red)/255,c=a._green-this._green/255,d=a._blue-this._blue/255;return Math.sqrt(b*b+c*c+d*d)/Math.sqrt(3)},d.toHex=function(){return"#"+((1<<24)+(this._red<<16)+(this._green<<8)+this._blue).toString(16).slice(1)},d.toHsl=function(){var a,b,c=this._red/255,d=this._green/255,e=this._blue/255,f=Math.max(c,d,e),g=Math.min(c,d,e),h=.5*(f+g);if(f==g)a=b=0;else{var i=f-g;switch(b=h>.5?i/(2-f-g):i/(f+g),f){case c:a=(d-e)/i+(1e-4>d-e?6:0);break;case d:a=(e-c)/i+2;break;case e:a=(c-d)/i+4}a/=6}return SDV.Color.Model.Hsl.create({hue:a,saturation:b,lightness:h})},d.toHsb=function(){var a=this._red/255,b=this._green/255,c=this._blue/255,d=Math.min(a,b,c),e=Math.max(a,b,c),f=e-d,g=0,h=0,i=e;if(d!=e){switch(h=f/e,e){case a:g=(b-c)/f+(1e-4>b-c?6:0);break;case b:g=(c-a)/f+2;break;case c:g=(a-b)/f+4}g/=6}return SDV.Color.Model.Hsb.create({hue:g,saturation:h,brightness:i})},d.clone=function(){return SDV.Color.Model.Rgb.create({red:this._red,green:this._green,blue:this._blue})},d.equals=function(a,b){if(!SDV.Color.Model.Rgb.isRgb(a))return!1;(!SDV.Util.Number.isNumber(b)||0>b)&&(b=0),b>1&&(b=1);var c=!1;return c=0==b?this._red===a._red&&this._green===a._green&&this._blue===a._blue:!(this.distanceTo(a)>b)}}(),SDV.Color.Model.Hsl={},function(){var a=function(a){this._hue=a.hue,this._saturation=a.saturation,this._lightness=a.lightness},b=function(a){var b=SDV.Color.Model.Rgb.create(a);return null!==b?b.toHsl():null};SDV.Color.Model.Hsl.create=function(c){var d,e,f=!1,g=SDV.Util.Validation.validateOption({optionName:"colorDefinition",isRequired:!0,allowedTypes:["Object","String"],postValidationMethod:function(){var a={isValid:!0,message:""};return SDV.Util.String.isString(c)?(d=SDV.Color.Model.Hex.isHex(c),e=SDV.Color.Model.Hex.Code.hasOwnProperty(c),d||e||(a.isValid=!1,a.message=SDV.Localization.getResource("wrongColorRepresentation")(c))):(f=!0,a=SDV.Util.Validation.validateOptions([{optionName:"hue",optionFullName:"colorDefinition.hue",isRequired:!0,allowedTypes:["Number"],minValue:0,minValueEqualityAllowed:!0,maxValue:1,maxValueEqualityAllowed:!0},{optionName:"saturation",optionFullName:"colorDefinition.saturation",isRequired:!0,allowedTypes:["Number"],minValue:0,minValueEqualityAllowed:!0,maxValue:1,maxValueEqualityAllowed:!0},{optionName:"lightness",optionFullName:"colorDefinition.lightness",isRequired:!0,allowedTypes:["Number"],minValue:0,minValueEqualityAllowed:!0,maxValue:1,maxValueEqualityAllowed:!0}],c)),a}},c);return g.isValid?d||e?b(c):f?new a(c):null:(console.error(g.message),null)},SDV.Color.Model.Hsl.isHsl=function(b){return b instanceof a};var c=function(a,b,c){var d=SDV.Util.Validation.validateOption({optionName:"componentValue",isRequired:!1,allowedTypes:["Number"],minValue:0,minValueEqualityAllowed:!0,maxValue:1,maxValueEqualityAllowed:!0},c);if(!d.isValid)return console.error(d.message),a;var e="_"+b;return d.isDefined?(a[e]=c,a):a[e]},d=SDV.Color.Model.Hsl.prototype=a.prototype={};d.hue=function(a){return c(this,"hue",a)},d.saturation=function(a){return c(this,"saturation",a)},d.lightness=function(a){return c(this,"lightness",a)},d.distanceTo=function(a){if(!SDV.Color.Model.Hsl.isHsl(a))return null;var b=a._hue-this._hue,c=a._saturation-this._saturation,d=a._lightness-this._lightness;return Math.sqrt(b*b+c*c+d*d)/Math.sqrt(3)},d.toHex=function(){return this.toRgb().toHex()},d.toRgb=function(){var a,b,c;if(0==this._saturation)a=b=c=this._lightness;else{var d=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},e=this._lightness<.5?this._lightness*(1+this._saturation):this._lightness+this._saturation-this._lightness*this._saturation,f=2*this._lightness-e;a=d(f,e,this._hue+1/3),b=d(f,e,this._hue),c=d(f,e,this._hue-1/3)}return SDV.Color.Model.Rgb.create({red:Math.round(255*a),green:Math.round(255*b),blue:Math.round(255*c)})},d.toHsb=function(){return this.toRgb().toHsb()},d.clone=function(){return SDV.Color.Model.Hsl.create({hue:this._hue,saturation:this._saturation,lightness:this._lightness})},d.equals=function(a,b){if(!SDV.Color.Model.Hsl.isHsl(a))return!1;(!SDV.Util.Number.isNumber(b)||0>b)&&(b=0),b>1&&(b=1);var c=!1;return c=0==b?this._hue===a._hue&&this._saturation===a._saturation&&this._lightness===a._lightness:!(this.distanceTo(a)>b)}}(),SDV.Color.Model.Hsb={},function(){var a=function(a){this._hue=a.hue,this._saturation=a.saturation,this._brightness=a.brightness},b=function(a){var b=SDV.Color.Model.Rgb.create(a);return null!==b?b.toHsb():null};SDV.Color.Model.Hsb.create=function(c){var d,e,f=!1,g=SDV.Util.Validation.validateOption({optionName:"colorDefinition",isRequired:!0,allowedTypes:["Object","String"],postValidationMethod:function(){var a={isValid:!0,message:""};return SDV.Util.String.isString(c)?(d=SDV.Color.Model.Hex.isHex(c),e=SDV.Color.Model.Hex.Code.hasOwnProperty(c),d||e||(a.isValid=!1,a.message=SDV.Localization.getResource("wrongColorRepresentation")(c))):(f=!0,a=SDV.Util.Validation.validateOptions([{optionName:"hue",optionFullName:"colorDefinition.hue",isRequired:!0,allowedTypes:["Number"],minValue:0,minValueEqualityAllowed:!0,maxValue:1,maxValueEqualityAllowed:!0},{optionName:"saturation",optionFullName:"colorDefinition.saturation",isRequired:!0,allowedTypes:["Number"],minValue:0,minValueEqualityAllowed:!0,maxValue:1,maxValueEqualityAllowed:!0},{optionName:"brightness",optionFullName:"colorDefinition.brightness",isRequired:!0,allowedTypes:["Number"],minValue:0,minValueEqualityAllowed:!0,maxValue:1,maxValueEqualityAllowed:!0}],c)),a}},c);return g.isValid?d||e?b(c):f?new a(c):null:(console.error(g.message),null)},SDV.Color.Model.Hsb.isHsb=function(b){return b instanceof a};var c=function(a,b,c){var d=SDV.Util.Validation.validateOption({optionName:"componentValue",isRequired:!1,allowedTypes:["Number"],minValue:0,minValueEqualityAllowed:!0,maxValue:1,maxValueEqualityAllowed:!0},c);if(!d.isValid)return console.error(d.message),a;var e="_"+b;return d.isDefined?(a[e]=c,a):a[e]},d=SDV.Color.Model.Hsb.prototype=a.prototype={};d.hue=function(a){return c(this,"hue",a)},d.saturation=function(a){return c(this,"saturation",a)},d.brightness=function(a){return c(this,"brightness",a)},d.distanceTo=function(a){if(!SDV.Color.Model.Hsb.isHsb(a))return null;var b=a._hue-this._hue,c=a._saturation-this._saturation,d=a._brightness-this._brightness;return Math.sqrt(b*b+c*c+d*d)/Math.sqrt(3)},d.toHex=function(){return this.toRgb().toHex()},d.toRgb=function(){var a,b,c,d=this._hue/(1/6),e=d-Math.floor(d),f=Math.floor(d)%2?(1-e)*this._brightness:e*this._brightness,g=1*this._brightness,h=(1-this._saturation)*this._brightness,i=f+(1-this._saturation)*(this._brightness-f);switch(d>=6&&(d=5.99),Math.floor(d)){case 0:a=g,b=i,c=h;break;case 1:a=i,b=g,c=h;break;case 2:a=h,b=g,c=i;break;case 3:a=h,b=i,c=g;break;case 4:a=i,b=h,c=g;break;case 5:a=g,b=h,c=i}return SDV.Color.Model.Rgb.create({red:Math.round(255*a),green:Math.round(255*b),blue:Math.round(255*c)})},d.toHsl=function(){return this.toRgb().toHsl()},d.clone=function(){return SDV.Color.Model.Hsb.create({hue:this._hue,saturation:this._saturation,brightness:this._brightness})},d.equals=function(a,b){if(!SDV.Color.Model.Hsb.isHsb(a))return!1;(!SDV.Util.Number.isNumber(b)||0>b)&&(b=0),b>1&&(b=1);var c=!1;return c=0==b?this._hue===a._hue&&this._saturation===a._saturation&&this._brightness===a._brightness:!(this.distanceTo(a)>b)}}(),SDV.Tool={},function(){var a={defaultOptions:{data:{},cloneData:!1,preprocessData:function(){return!1},mode:"default",modeOptions:undefined},validateOptions:function(a){var b=SDV.Util.Validation.validateOptions([{optionName:"cloneData",optionFullName:"options.cloneData",isRequired:!1,allowedTypes:["Boolean"],replaceWithDefaultIfUndefined:!0},{optionName:"preprocessData",optionFullName:"options.preprocessData",isRequired:!1,allowedTypes:["Function"],replaceWithDefaultIfUndefined:!1},{optionName:"mode",optionFullName:"options.mode",isRequired:!1,allowedTypes:["String"],allowedValues:this.Mode.getNames(),replaceWithDefaultIfUndefined:!0},{optionName:"modeOptions",optionFullName:"options.modeOptions",isRequired:!1,allowedTypes:["Object"]}],a,this.defaultOptions);if(!b.isValid)throw new Error(b.message);return b},validateData:function(a){a=a||{};var b=SDV.Util.Validation.validateOptions([{optionName:"data",optionFullName:"options.data",isRequired:!0,allowedTypes:["Object"],postValidationMethod:function(a){return SDV.Util.Geojson.validate(a)},postValidationMethodOptions:a.data}],a);if(!b.isValid)throw new Error(b.message);return b},preprocess:function(a){a=a||{};var b=a.cloneData?SDV.Util.Json.parse(SDV.Util.Json.stringify(a.data)):a.data,c=a.preprocessData;return SDV.Util.Function.isFunction(c)&&c(b),b},process:function(a,b){a=a||{};var c=this.Mode.getMethod(a.mode);return SDV.Util.Function.isFunction(c)?c(b,a.modeOptions):void 0},postprocess:function(a,b,c){return c}};a.extend=function(a){a=a||{};var b=SDV.Util.Object.isObject(a.defaultOptions)?a.defaultOptions:this.defaultOptions,c=SDV.Util.Function.isFunction(a.validateOptions)?a.validateOptions:this.validateOptions,d=SDV.Util.Function.isFunction(a.validateData)?a.validateData:this.validateData,e=SDV.Util.Function.isFunction(a.preprocess)?a.preprocess:this.preprocess,f=SDV.Util.Function.isFunction(a.process)?a.process:this.process,g=SDV.Util.Function.isFunction(a.postprocess)?a.postprocess:this.postprocess,h=function(a){var b=(c.call(h,a),d.call(h,a),e.call(h,a)),i=f.call(h,a,b),j=g.call(h,a,b,i);return j};h.defaultOptions=b,h.validateOptions=c,h.validateData=d,h.preprocess=e,h.process=f,h.postprocess=g,h.extend=this.extend;var i={};return h.Mode={extend:function(a){var b=SDV.Util.Validation.validateOptions([{optionName:"name",optionFullName:"toolModeOptions.name",isRequired:!0,allowedTypes:["String"]},{optionName:"method",optionFullName:"toolModeOptions.method",isRequired:!0,allowedTypes:["Function"]}],a);if(!b.isValid)throw new Error(b.message);i[a.name]=a.method},contains:function(a){return SDV.Util.String.isString(a)&&i.hasOwnProperty(a)},getNames:function(){return SDV.Util.Object.getPropertiesNames(i)},getMethod:function(a){return SDV.Util.String.isString(a)?i[a]:void 0}},h},SDV.Tool.base=a.extend(),SDV.Tool.base.Mode.extend({name:"default",method:function(a){return a}})}(),SDV.Tool.choropleth=SDV.Tool.base.extend({defaultOptions:{data:{},cloneData:!1,preprocessor:function(){return!1},mode:"random",modeOptions:undefined},validateOptions:SDV.Tool.base.validateOptions,validateData:function(a){a=a||{};var b=SDV.Util.Validation.validateOptions([{optionName:"data",optionFullName:"options.data",isRequired:!0,allowedTypes:["Object"],postValidationMethod:function(a){return SDV.Util.Geojson.validate(a,["Feature","FeatureCollection"])},postValidationMethodOptions:a.data}],a);if(!b.isValid)throw new Error(b.message);return b},preprocess:function(a){a=a||{};var b=a.cloneData?SDV.Util.Json.parse(SDV.Util.Json.stringify(a.data)):a.data,c=SDV.Util.Geojson.getGeoObjects(b,!1),d=a.preprocessData;return SDV.Util.Function.isFunction(d)&&SDV.Util.Array.each(c,d),{geojson:b,featuresArray:c}},process:function(a,b){a=a||{};var c=this.Mode.getMethod(a.mode);return SDV.Util.Function.isFunction(c)?c(b.featuresArray,a.modeOptions):void 0},postprocess:function(a,b,c){var d=b.geojson,e=b.featuresArray;return SDV.Util.Array.isArray(c)||(c=[]),SDV.Util.Array.each(e,function(a,b){var d=a.properties=SDV.Util.Object.isObject(a.properties)?a.properties:{},e=d.sdv=SDV.Util.Object.isObject(d.sdv)?d.sdv:{},f=e.choropleth=c[b];SDV.Util.Object.isObject(f)||(f=null)}),"Feature"===d.type?d.properties=e[0].properties:"FeatureCollection"===d.type&&(d.features=e),d}}),SDV.Tool.choropleth.Mode.extend({name:"random",method:function(a,b){b=b||{};var c={categoryProperty:undefined,colors:{count:undefined,hue:"random",saturation:"rich",brightness:"bright"},style:{fill:{opacity:.75},stroke:{weight:2,opacity:.85}}},d=SDV.Util.Validation.validateOptions([{optionName:"categoryProperty",optionFullName:"modeOptions.categoryProperty",isRequired:!1,allowedTypes:["String"]},{optionName:"style",optionFullName:"modeOptions.style",isRequired:!1,allowedTypes:["Object"],replaceWithDefaultIfUndefined:!0},{optionName:"colors",optionFullName:"modeOptions.colors",isRequired:!1,allowedTypes:["Object"],replaceWithDefaultIfUndefined:!0}],b,c);if(!d.isValid)throw new Error(d.message);b=SDV.Util.Object.extend(c,b,!0),b.colors.count=a.length;var e="undefined"!=typeof b.categoryProperty,f=SDV.Color.random(b.colors),g=b.style.fill,h=b.style.stroke;return SDV.Enumerable.create(a).select(function(a,c){var d=f[c],i=e?SDV.Util.Json.stringify(SDV.Util.Object.getPropertyValue({srcObject:a.properties,propertyName:b.categoryProperty})):"Category №"+c+1;return{category:i,style:{fill:{color:d,opacity:g.opacity},stroke:{color:d,weight:h.weight,opacity:h.opacity}}}}).toArray()}})}(window,document);